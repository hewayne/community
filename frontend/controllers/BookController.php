<?php/** * Created by PhpStorm. * User: wayne * Date: 2016/12/9 * Time: 1:53 */namespace frontend\controllers;use common\models\Book;use frontend\models\BookChapterForm;use frontend\models\BookForm;use yii\web\Controller;use Yii;class BookController extends Controller {    public function actionIndex(){        $books = (new Book())->find()            ->select(['id', 'book_id', 'book_name', 'cover_img'])            ->orderBy(['book_id' => SORT_DESC])            ->asArray()->all();        return $this->render('index', ['books' => $books]);    }    //通过章节id获取章节数据    public function actionView(){        $id = (int)Yii::$app->request->get('id');        $chapterData = (new BookChapterForm())->getChapter($id);        if (!$chapterData){            Yii::$app->session->setFlash('error', '数据不存在');            return $this->goBack();        }        return $this->render('view', ['chapter' => $chapterData]);    }    //通过book_id和catalog_id获取章节数据    public function actionChapter()    {        $catalog['book_id'] = (int)Yii::$app->request->get('book_id');        $catalog['catalog_id'] = (int)Yii::$app->request->get('catalog_id');        $model = new BookChapterForm();        $chapterData = $model->getChapterByCatalogId($catalog);        if (!$chapterData){            return "<script>alert('已经是最后一页'); location.href = 'index.php?r=book/index';</script>>";        }        return $this->render('view', ['chapter' => $chapterData]);    }    /*获取某一书籍的目录*/    public function actionCatalog(){        $bookId = (int)Yii::$app->request->get('id');        $catalogData['book'] = (new BookForm())->getBookInfo($bookId);        $catalogData['catalog'] = (new BookChapterForm())->getCatalogByBookId($bookId);        if (!$catalogData['book'] || !$catalogData['catalog']){            Yii::$app->session->setFlash('error', '数据不存在');            return $this->goBack();        }        return $this->render('catalog', ['catalog' => $catalogData]);    }}