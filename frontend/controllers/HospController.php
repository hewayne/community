<?php/** * Created by PhpStorm. * User: wayne * Date: 2016/11/16 * Time: 10:19 */namespace frontend\controllers;use common\models\Areas;use common\models\Cities;use common\models\Provinces;use frontend\models\HospForm;use Yii;class HospController extends BaseController {    public function actions()    {        return [            'captcha' => [                'class' => 'yii\captcha\CaptchaAction',                'fixedVerifyCode' => YII_ENV_TEST ? 'testme' : null,            ],        ];    }    public function actionIndex(){        $provinceData = Provinces::find()->asArray()->all();        return $this->render('index', ['provinces' => $provinceData]);    }    //创建宠物店信息    public function actionCreate(){        $model = new HospForm();        if (Yii::$app->request->isPost){            if ($model->load(\Yii::$app->request->post()) && $model->validate()){                if (!$model->create()){                    Yii::$app->session->setFlash('warning', $model->_lastError);                }else{                    return $this->redirect(['hosp/view', 'id' => $model->id]);                }            }else{                Yii::$app->session->addFlash('error', '上传失败');            }        }        $provinceData = Provinces::find()->asArray()->all();        return $this->render('create', ['model' => $model, 'provinces' => $provinceData]);    }    //宠物店编辑（替代上面的create）    public function actionEdit(){        $model = new HospForm();        if (Yii::$app->request->isPost){            if ($model->load(\Yii::$app->request->post()) && $model->validate()){                if (!$model->create()){                    Yii::$app->session->setFlash('warning', $model->_lastError);                }else{                    return $this->redirect(['hosp/view', 'id' => $model->id]);                }            }else{                Yii::$app->session->addFlash('error', '上传失败');            }        }        $provinceData = Provinces::find()->asArray()->all();        return $this->render('edit', ['model' => $model, 'provinces' => $provinceData]);    }    //展示单条宠物店信息    public function actionView(){        $id = (int)Yii::$app->request->get('id');        $hospData = (new HospForm())->getHospById($id);        return $this->render('view', ['hosp' => $hospData]);    }    //获取‘市’的数据    public function actionGetCity(){        $provinceId = Yii::$app->request->get('provinceId');        //获取市的数据        $citiesData = Cities::find()->where(['provinceid' => $provinceId])->asArray()->all();        return json_encode(['cities' => $citiesData]);        //print_r($citiesData);    }    //获取‘区’的数据    public function actionGetArea(){        $cityId = Yii::$app->request->get('cityId');        //获取市的数据        $areasData = Areas::find()->where(['cityid' => $cityId])->asArray()->all();        return json_encode(['areas' => $areasData]);        //print_r($areasData);    }    public function actionSearch(){        $ids = Yii::$app->request->get('ids');        //$ids = [440000,440400,440402];        //根据id查询hosp的数据        $model = new HospForm();        $hospData = $model->searchHosp($ids);        return json_encode($hospData);    }}