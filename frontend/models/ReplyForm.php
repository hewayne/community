<?php/** * Created by PhpStorm. * User: wayne * Date: 2016/12/30 * Time: 7:23 */namespace frontend\models;use common\models\Post;use common\models\Reply;use common\models\User;use yii\base\Model;class ReplyForm extends Model {    public function saveReply($post){        $content = htmlspecialchars(strip_tags($post['content']), ENT_QUOTES);        $postId = (int)$post['postId'];        $postUsername = htmlspecialchars(strip_tags($post['postUsername']));        $postTitle = htmlspecialchars(strip_tags($post['postTitle']));        $model = new Reply();        $model->post_id = $postId;        $model->content = $content;        $model->user_id = (int)\Yii::$app->user->id;        $model->time = time();        if (!$model->save()){            return false;        }        //将post的reply_num【回复数】增1        $postModel = Post::findOne($postId);        $postModel->updateCounters(['reply_num' => 1]);        //将用户的积分加20        $userModel = User::findOne(\Yii::$app->user->id);        $userModel->updateCounters(['point' => 20]);        //发送消息到帖子主人        $messageModel = new MessageForm();        $replyUserName = \Yii::$app->user->identity->username;        $messageModel->addMessage($replyUserName, $postUsername, $postId, $postTitle);        return true;    }}